<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reyz | Premium Dashboard</title>
    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #38bdf8;
            --danger: #f43f5e;
            --bg: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.15) 0px, transparent 50%);
            display: flex; justify-content: center; min-height: 100vh; color: #f1f5f9; padding: 20px;
        }

        .container {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            padding: 30px;
            border-radius: 32px;
            width: 100%;
            max-width: 440px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.8s ease-out;
            height: fit-content;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .user-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .profile-mini { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--primary); }
        
        .badge { padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .role-rahasia { background: linear-gradient(45deg, #ec4899, #8b5cf6); color: white; }
        .role-owner { background: #f59e0b; color: black; }
        .role-reseller { background: var(--primary); color: black; }

        input, select {
            width: 100%; padding: 15px; background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border); border-radius: 14px;
            color: white; margin-bottom: 12px; outline: none;
        }

        button {
            width: 100%; padding: 15px; border-radius: 14px; border: none;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }

        .btn-update { background: var(--primary); color: #0f172a; margin-bottom: 15px; }
        .btn-update:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(56, 189, 248, 0.3); }

        #status { font-size: 12px; text-align: center; min-height: 18px; margin-bottom: 15px; }

        .list-box { background: rgba(15, 23, 42, 0.4); border-radius: 20px; padding: 15px; border: 1px solid var(--border); }
        .num-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .num-val { font-size: 14px; font-family: monospace; }
        
        .del-btn { background: rgba(244, 63, 94, 0.1); color: var(--danger); width: auto; padding: 5px 10px; font-size: 11px; }
        .del-btn:hover { background: var(--danger); color: white; }

        .admin-panel { border: 1px dashed var(--primary); padding: 15px; border-radius: 20px; margin-bottom: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body onload="fetchList()">

<div class="container">
    <div class="user-header">
        <div>
            <h2 id="dn" style="font-size: 18px;">User</h2>
            <span id="dr" class="badge">Role</span>
        </div>
        <img src="https://e.top4top.io/p_3651z3u0b4.jpg" class="profile-mini">
    </div>

    <input type="number" id="numberInput" placeholder="628xxxxxxxxxx">
    <button onclick="handleProcess()" id="btnAction" class="btn-update">Update Database</button>
    <div id="status"></div>

    <div id="adminPanel" class="admin-panel hidden">
        <p style="font-size: 11px; color: var(--primary); margin-bottom: 10px; font-weight: 700;">ðŸ‘‘ CREATE ACCOUNT</p>
        <input type="text" id="nu" placeholder="New Username">
        <input type="text" id="np" placeholder="New Password">
        <select id="nr"><option value="Reseller">Reseller</option><option value="Owner">Owner</option></select>
        <button onclick="createUser()" style="background: #10b981; color: white;">Create User</button>
    </div>

    <div class="list-box">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span style="font-size: 12px; font-weight: 700;">ACTIVE DATABASE</span>
            <span id="countDisplay" style="font-size: 12px; color: #64748b;">0</span>
        </div>
        <div id="numberList" style="max-height: 200px; overflow-y: auto;"></div>
    </div>
    
    <button onclick="sessionStorage.clear();location.href='index.html'" style="margin-top: 20px; background: none; color: #64748b; font-size: 12px;">Logout System</button>
</div>

<script>
    // Ambil Config & Session
    const { github, api } = window.CONFIG;
    const role = sessionStorage.getItem('r');
    const user = sessionStorage.getItem('u');
    
    // Tampilkan Info User
    document.getElementById('dn').innerText = user;
    const dr = document.getElementById('dr');
    dr.innerText = role;
    dr.className = 'badge role-' + role.toLowerCase();
    if(role === 'Rahasia' || role === 'Owner') document.getElementById('adminPanel').classList.remove('hidden');

    const gitUrl = `https://api.github.com/repos/${github.owner}/${github.repo}/contents/${github.path}`;
    const gitHeaders = { Authorization: `token ${github.token}`, Accept: 'application/vnd.github.v3+json' };

    async function fetchList() {
        const listDiv = document.getElementById('numberList');
        try {
            const { data } = await axios.get(gitUrl, { headers: gitHeaders });
            const numbers = JSON.parse(atob(data.content)).dbny || [];
            document.getElementById('countDisplay').innerText = numbers.length;
            listDiv.innerHTML = numbers.slice().reverse().map(n => `
                <div class="num-item">
                    <div class="num-val">ðŸ“± ${n}</div>
                    ${(role==='Owner'||role==='Rahasia') ? `<button class="del-btn" onclick="deleteNumber('${n}')">DELETE</button>` : ''}
                </div>
            `).join('');
        } catch (err) { listDiv.innerHTML = "Gagal memuat data."; }
    }

    async function handleProcess() {
        const input = document.getElementById('numberInput');
        const num = input.value.trim();
        if (!num) return;
        setLoading(true, 'â³ Processing...');
        try {
            const { data } = await axios.get(gitUrl, { headers: gitHeaders });
            const jsonData = JSON.parse(atob(data.content));
            if (jsonData.dbny.includes(num)) {
                showStatus('âš ï¸ Nomor sudah ada!', '#fbbf24');
            } else {
                jsonData.dbny.push(num);
                await axios.put(gitUrl, { message: `Add ${num}`, content: btoa(JSON.stringify(jsonData, null, 2)), sha: data.sha }, { headers: gitHeaders });
                showStatus('âœ… Berhasil ditambahkan!', '#10b981');
                input.value = ''; fetchList();
            }
        } catch (err) { showStatus('âŒ Gagal update.', '#f43f5e'); }
        finally { setLoading(false); }
    }

    async function deleteNumber(numDel) {
        if (!confirm(`Hapus ${numDel}?`)) return;
        setLoading(true, 'â³ Deleting...');
        try {
            const { data } = await axios.get(gitUrl, { headers: gitHeaders });
            const jsonData = JSON.parse(atob(data.content));
            jsonData.dbny = jsonData.dbny.filter(n => n !== numDel);
            await axios.put(gitUrl, { message: `Del ${numDel}`, content: btoa(JSON.stringify(jsonData, null, 2)), sha: data.sha }, { headers: gitHeaders });
            showStatus('ðŸ—‘ï¸ Berhasil dihapus.', '#f43f5e');
            fetchList();
        } catch (err) { showStatus('âŒ Gagal hapus.', '#f43f5e'); }
        finally { setLoading(false); }
    }

    async function createUser() {
        const nu = document.getElementById('nu').value;
        const np = document.getElementById('np').value;
        const nr = document.getElementById('nr').value;
        try {
            await axios.post(api.userUrl, { username: nu, pass: np, role: nr });
            alert("User Berhasil Dibuat!");
        } catch (e) { alert("Gagal!"); }
    }

    function setLoading(s, t) {
        const b = document.getElementById('btnAction');
        const st = document.getElementById('status');
        b.disabled = s;
        if (s) { st.style.color = '#38bdf8'; st.innerHTML = t; }
    }

    function showStatus(t, c) {
        const st = document.getElementById('status');
        st.style.color = c; st.innerHTML = t;
        setTimeout(() => { st.innerHTML = ''; }, 3000);
    }
</script>
</body>
</html>        }

        async function createUser() {
            try {
                await axios.post(api.userUrl, { username: nu.value, pass: np.value, role: nr.value });
                alert("Sukses!"); nu.value = ""; np.value = "";
            } catch(e) { alert("Gagal!"); }
        }
        fetchList();
    </script>
</body>
</html>
